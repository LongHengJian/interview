### 系统设计
#### 系统设计

##### Q1. 接口设计要考虑哪些方面？
1. 接口版本化
2. 命名规范
3. 请求参数的规范性及处理的统一性
4. 返回数据类型、返回码及信息提示的规范性
5. 接口安全验证及权限的控制
6. 请求接口日志的记录
7. 良好的接口说明文档和测试程序

##### Q2. 什么是接口幂等？如何保证接口的幂等性？
接口的幂等性实际上就是接口可重复调用，在调用方多次调用的情况下，接口最终得到的结果是一致的。

有些接口可以天然的实现幂等性，比如查询接口，对于查询来说，你查询一次和两次，对于系统来说，没有任何影响，查出的结果也是一样。

除了查询功能具有天然的幂等性之外，增加、更新、删除都要保证幂等性。那么如何来保证幂等性呢？

1. 全局唯一ID
    - 如果使用全局唯一ID，就是根据业务的操作和内容生成一个全局ID，在执行操作前先根据这个全局唯一ID是否存在，来判断这个操作是否已经执行。
    - 如果不存在则把全局ID，存储到存储系统中，比如数据库、redis等。如果存在则表示该方法已经执行。
    - 从工程的角度来说，使用全局ID做幂等可以作为一个业务的基础的微服务存在，在很多的微服务中都会用到这样的服务，在每个微服务中都完成这样的功能，会存在工作量重复。
    - 另外打造一个高可靠的幂等服务还需要考虑很多问题，比如一台机器虽然把全局ID先写入了存储，但是在写入之后挂了，这就需要引入全局ID的超时机制
    - 使用全局唯一ID是一个通用方案，可以支持插入、更新、删除业务操作。
    - 但是这个方案看起来很美但是实现起来比较麻烦，下面的方案适用于特定的场景，但是实现起来比较简单。
2. 去重表
    - 这种方法适用于在业务中有唯一标的插入场景中，比如在以上的支付场景中，如果一个订单只会支付一次，所以订单ID可以作为唯一标识。
    - 这时，我们就可以建一张去重表，并且把唯一标识作为唯一索引，在我们实现时，把创建支付单据和写入去去重表，放在一个事务中，如果重复创建，数据库会抛出唯一约束异常，操作就会回滚。
3. 插入或更新
    - 这种方法插入并且有唯一索引的情况，比如我们要关联商品品类，其中商品的ID和品类的ID可以构成唯一索引，并且在数据表中也增加了唯一索引
    - 这时就可以使用InsertOrUpdate操作。
4. 多版本控制
    - 这种方法适合在更新的场景中，比如我们要更新商品的名字，这时我们就可以在更新的接口中增加一个版本号，来做幂等
5. 状态机控制
    - 这种方法适合在有状态机流转的情况下
    - 这时我们可以通过在设计状态字段时，使用int类型，并且通过值类型的大小来做幂等
    - 在做状态机更新时，我们就这可以这样控制