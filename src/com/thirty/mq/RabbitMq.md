### MQ相关面试题

#### RabbitMQ

##### Q1. 为什么要使用MQ
1. 解耦
   - 模块与模块之间，互相调用复杂，维护也麻烦，但是这个调用不需要直接同步调用接口的，可以用MQ来进行异步解耦，减少系统依赖
2. 异步
   - 对于数据量大或者处理耗时长的操作，我们可以引入MQ 实现异步通信，减少客户端的等待，提升响应速度
3. 削峰
   - 减少高峰时期对服务器压力，可以对应用和数据库进行保护

##### Q2. MQ有什么优缺点
- 系统可用性降低
- 系统复杂度提高，引入MQ会增加很多的问题
- 一致性问题，多个系统调用MQ处理，其中一个出现问题之后，数据可能出现不一致

##### Q3. 如何保证消息的可靠传输？如果消息丢了怎么办
数据丢失问题，可能出现在生产者、MQ、消费者当中
1. 对于生产者丢失，一般有两种处理方案
   - 第一种是开启RabbiMQ事务，这种处理是同步方式，不推荐
   - 第二种是开启confirm模式(异步，推荐)
2. MQ丢失
   - 对于MQ丢失，我们可以开启MQ的持久化，这样MQ恢复之后，也会去自动读取存储的数据，一般情况下不会造成丢失。
   - 这个持久化必须把队列和消息同时设置持久化。
3. 消息端丢失
   - 关闭RabbitMQ的自动ACK，变成手动的ACK。

##### Q4. 如何保证消息的顺序性
1. 拆分多个 queue，每个 queue 一个 consumer，就是多一些 queue 而已，确实是麻烦点；
2. 或者就一个 queue 但是对应一个 consumer，然后这个 consumer 内部用内存队列做排队，然后分发给底层不同的 worker 来处理
